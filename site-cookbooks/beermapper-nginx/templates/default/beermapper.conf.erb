server {
  listen 80;
  server_name beermapper-api.com;
  access_log logs/beermapper.access.log;

  root <%= @server_root %>;
  passenger_enabled on;
  rails_env <%= @rails_env %>;
  charset utf-8;
}

server {
  listen 443 ssl;
  server_name <%= @beermapper_domain_name %>;
  root /var/apps/beermapper-frontend/current/dist;

  ssl on;
  ssl_certificate /etc/letsencrypt/current/<%= @beermapper_domain_name %>/fullchain.pem;
  ssl_certificate_key /etc/letsencrypt/current/<%= @beermapper_domain_name %>/key.pem;

  location /api/v1/ {
    proxy_pass http://beermapper-api.com;
  }

  location ~ /.well-known/ {
    root <%= @webroot_dir %>/<%= @beermapper_domain_name %>;
  }

  include /opt/nginx/snippets/ssl-params.conf;
}

server {
  listen 80;
  server_name <%= @beermapper_domain_name %>;
  rewrite ^(.*)$ https://<%= @beermapper_domain_name %>$1;
}

server {
  listen 80;
  server_name www.<%= @beermapper_domain_name %>;
  rewrite ^(.*)$ https://<%= @beermapper_domain_name %>$1;
}

server {
  listen 443 ssl;
  server_name www.<%= @beermapper_domain_name %>;
  rewrite ^(.*)$ https://<%= @beermapper_domain_name %>$1;
}
